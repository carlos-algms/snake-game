(()=>{"use strict";var t,e;!function(t){t[t.Up=0]="Up",t[t.Right=1]="Right",t[t.Down=2]="Down",t[t.Left=3]="Left"}(t||(t={})),function(t){t[t.Up=-1]="Up",t[t.Right=1]="Right",t[t.Down=1]="Down",t[t.Left=-1]="Left",t[t.Still=0]="Still"}(e||(e={}));class i{constructor(){this.position={x:0,y:0},this.moveRandom=t=>{this.position.x=Math.floor(Math.random()*t),this.position.y=Math.floor(Math.random()*t)}}}class s{constructor(){this.position={x:10,y:10},this.facingDirection=null,this.justMovedDirection=!1,this.offset={x:e.Still,y:e.Still},this.tailSize=s.INITIAL_TAIL_SIZE,this.trail=[],this.changeFacingDirection=(i,s)=>{if(null===i||i===this.facingDirection)return!1;if(!this.isDirectionChangePossible(i))return!1;switch(i){case t.Up:this.offset.x=e.Still,this.offset.y=e.Up;break;case t.Right:this.offset.x=e.Right,this.offset.y=e.Still;break;case t.Down:this.offset.x=e.Still,this.offset.y=e.Down;break;case t.Left:this.offset.x=e.Left,this.offset.y=e.Still}return this.facingDirection=i,this.justMovedDirection=!0,this.move(s),!0},this.isDirectionChangePossible=e=>{const{facingDirection:i}=this;return null===i||(e===t.Up||e===t.Down?i===t.Left||i===t.Right:i===t.Up||i===t.Down)},this.moveOffset=t=>this.justMovedDirection?(this.justMovedDirection=!1,this.position):this.move(t)}move(t){const{position:e,offset:i}=this;return this.maintainTrail(),(i.x||i.y)&&(e.x+=i.x,e.y+=i.y,e.x<0&&(e.x=t-1),e.x>t-1&&(e.x=0),e.y<0&&(e.y=t-1),e.y>t-1&&(e.y=0)),e}maintainTrail(){const{trail:t,tailSize:e,position:i}=this;for(t.push({...i});t.length>e;)t.shift()}}s.INITIAL_TAIL_SIZE=5;class r{constructor(){this.gridSize=20,this.canvasSize=0,this.rectangleSize=0,this.calculateSizes=()=>{const t=this.canvasElement.parentElement,{clientHeight:e,clientWidth:i}=t;let s=e<i?e:i;s<300&&(s=300),this.rectangleSize=Math.floor(s/this.gridSize),this.canvasSize=this.rectangleSize*this.gridSize,this.canvasElement.width=this.canvasSize,this.canvasElement.height=this.canvasSize},this.clear=()=>{const{ctx:t,canvasSize:e}=this;t.fillStyle="black",t.fillRect(0,0,e,e)},this.drawRectangle=(t,e)=>{const{ctx:i,rectangleSize:s}=this;i.fillRect(t*s,e*s,s-2,s-2)},this.drawStep=({x:t,y:e})=>{this.ctx.fillStyle="lime",this.drawRectangle(t,e)},this.drawItem=({x:t,y:e})=>{this.ctx.fillStyle="red",this.drawRectangle(t,e)},this.canvasElement=document.getElementById("app-canvas"),this.calculateSizes();let t=0;this.clear(),window.addEventListener("resize",(()=>{clearTimeout(t),t=window.setTimeout(this.calculateSizes,150)}))}get ctx(){return this.canvasElement.getContext("2d")}}class o{constructor(t){this.score=t,this.isMoving=!1,this.stage=new r,this.player=new s,this.item=new i,this.item.moveRandom(this.stage.gridSize),this.stage.drawItem(this.item.position),this.stage.drawStep(this.player.position),t.resetCurrentScore()}keyPressed(e){var i;const s=function(e){switch(e){case"ArrowLeft":return t.Left;case"ArrowUp":return t.Up;case"ArrowRight":return t.Right;case"ArrowDown":return t.Down;default:return null}}(null!==(i=e.key)&&void 0!==i?i:e.code);this.player.changeFacingDirection(s,this.stage.gridSize)&&(this.isMoving=!0,this.checkForHits(),this.draw())}tick(){this.isMoving&&(this.movePlayer(),this.checkForHits(),this.draw())}movePlayer(){const{stage:t,player:e}=this;e.moveOffset(t.gridSize)}checkForHits(){const{stage:t,player:e,item:i,score:r}=this;e.trail.forEach((t=>{this.checkHit(t,e.position)&&(e.tailSize=s.INITIAL_TAIL_SIZE,r.updateBestScore(),r.resetCurrentScore())})),this.checkHit(e.position,i.position)&&(e.tailSize++,i.moveRandom(t.gridSize),r.incrementCurrentScore())}checkHit(t,e){return t.x===e.x&&t.y===e.y}draw(){const{stage:t,player:e,item:i}=this;t.clear(),e.trail.forEach((e=>t.drawStep(e))),t.drawItem(i.position)}}class n{constructor(){this.scoreEl=document.getElementById("score"),this.bestScoreEl=document.getElementById("bestScore")}onScoreUpdate(t){this.scoreEl.textContent=t.toString()}onBestScoreUpdate(t){this.bestScoreEl.textContent=t.toString()}}const c="BEST_SCORE";class h{constructor(){this.currentScore=0,this.bestScore=0,this.scoreUi=new n,this.restoreBestScore(),this.scoreUi.onBestScoreUpdate(this.bestScore)}getCurrentScore(){return this.currentScore}getBestScore(){return this.bestScore}incrementCurrentScore(){this.currentScore+=1,this.scoreUi.onScoreUpdate(this.currentScore)}resetCurrentScore(){this.currentScore=0,this.scoreUi.onScoreUpdate(this.currentScore)}updateBestScore(){this.currentScore>this.bestScore&&(this.bestScore=this.currentScore,this.scoreUi.onBestScoreUpdate(this.bestScore),localStorage.setItem(c,this.bestScore.toString()))}restoreBestScore(){var t;try{const e=parseInt(null!==(t=localStorage.getItem(c))&&void 0!==t?t:"0",10);this.bestScore=e}catch(t){console.error(t)}}}!function(){const t=new h,e=new o(t);setInterval((function(){e.tick()}),100),document.addEventListener("keydown",(function(t){e.keyPressed(t)}))}()})();
//# sourceMappingURL=index-ff0310b2eb79bec1eba1.js.map